<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>VUMC Service Countdown</title>
  <style>
    body {
      background: transparent;
      color: white;
      text-align: center;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    .countdown {
      font-size: 2em;
      margin-bottom: 10px;
    }
    .label {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .live-button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      text-decoration: none;
    }
    .live {
      background-color: red;
      color: white;
    }
    .not-live {
      background-color: gray;
      color: white;
    }
  </style>
</head>
<body>

  <div class="label" id="serviceInfo">Loading...</div>
  <div class="countdown" id="countdown">Loading...</div>
  <a id="liveButton" class="live-button not-live" href="#" target="_blank">Service Not Online</a>

  <script>
    function getNextService() {
      const now = new Date();
      const day = now.getDay();
      const base = new Date(now.getFullYear(), now.getMonth(), now.getDate());

      let sunday = new Date(base);
      if (day !== 0) {
        // If not Sunday, set to upcoming Sunday
        sunday.setDate(sunday.getDate() + (7 - day));
      }

      const services = [
        { label: "Traditional Worship", time: new Date(sunday.getFullYear(), sunday.getMonth(), sunday.getDate(), 9, 30, 0) },
        { label: "Contemporary Worship", time: new Date(sunday.getFullYear(), sunday.getMonth(), sunday.getDate(), 10, 30, 0) }
      ];

      for (let service of services) {
        if (service.time > now) {
          return service;
        }
      }

      // If both are past, return next week's first service
      let nextSunday = new Date(sunday);
      nextSunday.setDate(nextSunday.getDate() + 7);
      return {
        label: "Traditional Worship",
        time: new Date(nextSunday.getFullYear(), nextSunday.getMonth(), nextSunday.getDate(), 9, 30, 0)
      };
    }

    function updateCountdown() {
      const now = new Date();
      const nextService = getNextService();
      const countdown = document.getElementById('countdown');
      const liveButton = document.getElementById('liveButton');
      const serviceInfo = document.getElementById('serviceInfo');

      const serviceDate = nextService.time.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
      const serviceTime = nextService.time.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' });

      serviceInfo.innerText = `${nextService.label} – ${serviceDate} at ${serviceTime} EST`;

      const diff = nextService.time - now;

      if (diff <= 0) {
        countdown.innerText = "We're Live!";
        liveButton.innerText = "We Are Live →";
        liveButton.className = "live-button live";
        liveButton.href = "https://live.versaillesumc.org";
        return;
      }

      const hrs = Math.floor(diff / 1000 / 60 / 60);
      const mins = Math.floor((diff / 1000 / 60) % 60);
      const secs = Math.floor((diff / 1000) % 60);

      countdown.innerText = `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      liveButton.innerText = "Service Not Online";
      liveButton.className = "live-button not-live";
      liveButton.href = "#";
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>

</body>
</html>
